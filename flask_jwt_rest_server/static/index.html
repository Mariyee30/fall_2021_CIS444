<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<style>
			table, th, td {
				padding: 15px;
				text-align: center;
				background-color:Â #04AA6D;
				border: 1px solid black;
				color: white;
			}

			body {
				background-image: url('https://i.pinimg.com/originals/3c/93/13/3c931317327e34802a569034c1d1fb5c.gif');
				height: 100%
				background-position: center;
				background-repeat: no-repeat;
				background-size: cover;
			}

			html {
				font-family: "Lato", Arial, sans-serif;
			}

			#login {
				margin-left: auto;
				margin-right: auto;
				margin-top: 300px;
				position: relative;
				z-index: 1;
				background: #FFFFFF;
				max-width: 360px;
				padding; 45px;
				text-align" center;
				box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
				border-radius: 10px;
			}

		</style>

		<div id="login">
			<h2>Crafting Table Login</h2>
			<label>Username:</label><br>
			<input type="text" id="userInput"name="username"></input><br>
			<label>Password:</label><br>
			<input type="password" id="passInput" name="password"></input><br><br>
			<input type="submit" value="Login" onclick="verification()">
		</div>

		<div id="craftingItems">
			<h1 style="color: White">Crafting Items</h1>
			<table>
				<thead>
					<tr>
						<th></th>
						<th>Book Title</th>
						<th>Author</th>
						<th>Price</th>
					</tr>
				</thead>
				<tbody id="items">
				</tbody>
			</table>
		</div>


		<div id="purchasedItems">
			<h1 style="color: White">Your Purchased Items</h1>
			<table>
				<thead>
					<tr>
						<th></th>
						<th>Book Title</th>
						<th>Author</th>
						<th>Price</th>
					</tr>
				</thead>
				<tbody id="purchaseditems">
				</tbody>
			</table>
		</div>

		<script>
			var token;
			var response;
			$("#craftingItems").hide();
			$("#purchasedItems").hide();

			async function verification(){
				const response = await $.post("/open_api/login", {"username": document.getElementById("userInput").value, "password": document.getElementById("passInput").value}, "json");
				if(response.status == 200){
					token = await response.data;
					getBooks();
					$("#login").hide();
					$("#craftingItems").show();
				}else{
					alert(response.data.message);
				}
			}

			async function getBooks(){
				const response = await $.post("/secure_api/get_books", {"jwt": token.jwt}, "json");
				console.log(response.data.books.length);
				for(i = 0; i < response.data.books.length; i++) {
					$("#items").append( "<tr><td><button id=\"" + response.data.books[i].book_id + "\" onclick=\"purchaseBook(this.id);\">Buy</button></td>" + "<td>" + response.data.books[i].title + "</td>" + "<td>" + response.data.books[i].author + "</td>" + "<td>$" + response.data.books[i].price + "</td></tr>"); 
				}
			}

			async function purchaseBook(id){
				const response = await $.post("/secure_api/purchase_book", {"jwt": token.jwt, "book_id": id}, "json"); 
				alert(response.data.message); 
				if (response.status == 200){
					$("#purchasedItems").show();
				}
			}
		</script>	
	</body>
</html>
